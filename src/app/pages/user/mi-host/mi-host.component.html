<div class="mi-host-container" [class.modal-open]="mostrarModal">
  <div class="header">
    <h1>Mi Host</h1>
    <p class="subtitle">Gestiona tus servicios y terrazas registradas</p>
  </div>

  <div class="acciones-header">
    <button class="btn-registrar" (click)="abrirModal()">
      <span class="btn-icon">+</span>
      Registrar Servicio o Terraza
    </button>
  </div>

  <div class="registros-grid" *ngIf="cards.length > 0">
    <p-card class="registro-card" *ngFor="let item of cards">
      <div class="card-badge" [class.badge-terraza]="item.tipo === 'terraza'" 
           [class.badge-servicio]="item.tipo === 'servicio'">
        {{ item.tipo === 'terraza' ? 'ğŸ›ï¸ Terraza' : 'ğŸ‰ Servicio' }}
      </div>

      <div class="card-image">
        <img [src]="item.imagen" [alt]="item.nombre" />
      </div>

      <div class="card-content">
        <h3 class="item-nombre">{{ item.nombre }}</h3>
        <p class="item-descripcion">{{ item.descripcion }}</p>

        <div class="item-info" *ngIf="item.capacidadBase && item.capacidadMaxima">
          <div class="info-item">
            <span class="info-label">Capacidad:</span>
            <span class="info-value">{{ item.capacidadBase }} - {{ item.capacidadMaxima }} personas</span>
          </div>
        </div>

        <div class="item-info" *ngIf="item.tipo === 'terraza'">
          <div class="info-item">
            <span class="info-label">ğŸ“ UbicaciÃ³n:</span>
            <span class="info-value">{{ item.ciudad }}, {{ item.ubicacion }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">ğŸ·ï¸ Tipo:</span>
            <span class="info-value">{{ item.tipoEtiqueta || 'Terraza' }}</span>
          </div>
        </div>

        <!-- <div class="tag-row" *ngIf="item.tags?.length">
          <p-tag *ngFor="let tag of item.tags" [value]="tag" severity="info" class="tag-chip"></p-tag>
        </div> -->

        <div class="precio-container">
          <span class="precio-label">Precio Base:</span>
          <span class="precio-valor">${{ item.precioBase.toLocaleString('es-MX') }}</span>
        </div>

        <div class="card-acciones">
          <button pButton class="btn-editar p-button-sm" icon="pi pi-pencil" [label]="'Editar'" (click)="editarRegistro(item)"></button>
          <button pButton class="btn-eliminar p-button-sm" icon="pi pi-trash" [label]="'Eliminar'" (click)="eliminarRegistro(item.id)"></button>
        </div>
      </div>
    </p-card>
  </div>

  <div class="empty-state" *ngIf="cards.length === 0">
    <div class="empty-icon">ğŸ“‹</div>
    <h2>No tienes servicios o terrazas registradas</h2>
    <p>Comienza agregando tu primer servicio o terraza</p>
  </div>
</div>

<!-- Modal de Registro -->
<div class="modal-overlay" *ngIf="mostrarModal">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="btn-cerrar" (click)="cerrarModal()">
      <span>&times;</span>
    </button>

    <div class="modal-header">
      <h2>{{ formulario.id ? 'Editar' : 'Registrar' }} {{ tipoSeleccionado ? (tipoSeleccionado === 'terraza' ? 'Terraza' : 'Servicio') : 'Nuevo Registro' }}</h2>
    </div>

    <div class="modal-body">
      <!-- SelecciÃ³n de Tipo (solo al crear nuevo) -->
      <div class="tipo-selector" *ngIf="!tipoSeleccionado">
        <h3>Â¿QuÃ© deseas registrar?</h3>
        <div class="tipo-opciones">
          <button class="tipo-opcion" (click)="seleccionarTipo('servicio')">
            <div class="tipo-icon">ğŸ‰</div>
            <h4>Servicio</h4>
            <p>Catering, fotografÃ­a, mÃºsica, etc.</p>
          </button>
          <button class="tipo-opcion" (click)="seleccionarTipo('terraza')">
            <div class="tipo-icon">ğŸ›ï¸</div>
            <h4>Terraza</h4>
            <p>Salones, jardines, espacios al aire libre</p>
          </button>
        </div>
      </div>

      <!-- Formulario -->
      <form class="formulario" *ngIf="tipoSeleccionado" (ngSubmit)="guardarRegistro()">
        <!-- Imagen -->
        <div class="form-group">
          <label class="form-label">Imagen *</label>
          <div class="imagen-upload">
            <input type="file" 
                   id="imagen" 
                   accept="image/*" 
                   (change)="onImagenSeleccionada($event)"
                   #fileInput
                   style="display: none;">
            <button type="button" class="btn-upload" (click)="fileInput.click()">
              ğŸ“· Seleccionar Imagen
            </button>
            <div class="imagen-preview" *ngIf="imagenPreview">
              <img [src]="imagenPreview" alt="Preview">
            </div>
          </div>
        </div>

        <!-- Nombre -->
        <div class="form-group">
          <label class="form-label">Nombre {{ tipoSeleccionado === 'terraza' ? 'de la Terraza' : 'del Servicio' }} *</label>
          <input type="text" 
                 class="form-control" 
                 [(ngModel)]="formulario.nombre" 
               name="nombre"
               (ngModelChange)="onFormChange()"
                 placeholder="Ingresa el nombre"
                 required>
        </div>

        <!-- Tipo de Servicio -->
        <div class="form-group" *ngIf="tipoSeleccionado === 'servicio'">
          <label class="form-label">Tipo de Servicio *</label>
          <p-dropdown 
            [options]="serviceTypeOptions"
            placeholder="Selecciona un tipo"
            [(ngModel)]="formulario.tipoServicio"
            name="tipoServicio"
            (ngModelChange)="onFormChange()"
            optionLabel="label"
            optionValue="value"
            [showClear]="true"
            appendTo="body"
            scrollHeight="260px"
            [autoZIndex]="true"
            [baseZIndex]="1300"
            styleClass="modal-dropdown-panel"></p-dropdown>
        </div>

        <!-- DescripciÃ³n -->
        <div class="form-group">
          <label class="form-label">DescripciÃ³n *</label>
          <textarea class="form-control" 
                    [(ngModel)]="formulario.descripcion" 
                    name="descripcion"
                    (ngModelChange)="onFormChange()"
                    rows="3"
                    placeholder="Describe las caracterÃ­sticas principales"
                    required></textarea>
        </div>

        <!-- Capacidades (opcional) -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Capacidad Base</label>
            <p-inputNumber 
              inputId="capacidadBase"
              [(ngModel)]="formulario.capacidadBase" 
              name="capacidadBase"
              (ngModelChange)="onFormChange()"
              mode="decimal"
              [useGrouping]="false"
              placeholder="Ej: 50"></p-inputNumber>
          </div>
          <div class="form-group">
            <label class="form-label">Capacidad MÃ¡xima</label>
            <p-inputNumber 
              inputId="capacidadMaxima"
              [(ngModel)]="formulario.capacidadMaxima" 
              name="capacidadMaxima"
              (ngModelChange)="onFormChange()"
              mode="decimal"
              [useGrouping]="false"
              placeholder="Ej: 100"></p-inputNumber>
          </div>
        </div>

        <!-- Precio Base -->
        <div class="form-group">
          <label class="form-label">Precio Base *</label>
          <p-inputNumber 
            inputId="precioBase"
            class="w-full"
            [(ngModel)]="formulario.precioBase" 
            name="precioBase"
              (ngModelChange)="onFormChange()"
            mode="currency"
            currency="MXN"
            locale="es-MX"
            required></p-inputNumber>
        </div>

        <!-- Campos especÃ­ficos para Terraza -->
        <div *ngIf="tipoSeleccionado === 'terraza'">
          <div class="form-group">
            <label class="form-label">UbicaciÃ³n *</label>
            <input type="text" 
                   class="form-control" 
                   [(ngModel)]="formulario.ubicacion" 
                   name="ubicacion"
                   (ngModelChange)="onFormChange()"
                   placeholder="Ej: Zona Centro"
                   required>
          </div>

          <div class="form-group">
            <label class="form-label">DirecciÃ³n *</label>
            <input type="text" 
                   class="form-control" 
                   [(ngModel)]="formulario.direccion" 
                   name="direccion"
                   (ngModelChange)="onFormChange()"
                   placeholder="Ej: Av. JuÃ¡rez 123"
                   required>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Lugar *</label>
              <input type="text" 
                     class="form-control" 
                     [(ngModel)]="formulario.lugar" 
                     name="lugar"
                     (ngModelChange)="onFormChange()"
                     placeholder="Ej: Centro HistÃ³rico"
                     required>
            </div>
            <div class="form-group">
              <label class="form-label">Ciudad *</label>
              <p-dropdown 
                [options]="cityOptions"
                placeholder="Selecciona una ciudad"
                [(ngModel)]="formulario.ciudad"
                name="ciudad"
                (ngModelChange)="onFormChange()"
                optionLabel="label"
                optionValue="value"
                [showClear]="true"
                appendTo="body"
                scrollHeight="260px"
                [autoZIndex]="true"
                [baseZIndex]="1300"
                styleClass="modal-dropdown-panel"
                required></p-dropdown>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Tipo de Terraza *</label>
            <p-dropdown 
              [options]="terraceTypeOptions" 
              placeholder="Selecciona un tipo"
              [(ngModel)]="formulario.tipoTerraza" 
              name="tipoTerraza"
              (ngModelChange)="onFormChange()"
              optionLabel="label"
              optionValue="value"
              [showClear]="true"
              appendTo="body"
              scrollHeight="260px"
              [autoZIndex]="true"
              [baseZIndex]="1300"
              styleClass="modal-dropdown-panel"
              required></p-dropdown>
          </div>
        </div>

        <!-- Ciudad para servicio -->
        <div class="form-group" *ngIf="tipoSeleccionado === 'servicio'">
          <label class="form-label">Ciudad *</label>
          <p-dropdown 
            [options]="cityOptions"
            placeholder="Selecciona una ciudad"
            [(ngModel)]="formulario.ciudad"
            name="ciudad"
            (ngModelChange)="onFormChange()"
            optionLabel="label"
            optionValue="value"
            [showClear]="true"
            appendTo="body"
            scrollHeight="260px"
            [autoZIndex]="true"
            [baseZIndex]="1300"
            styleClass="modal-dropdown-panel"
            required></p-dropdown>
        </div>

        <!-- Botones -->
        <div class="form-acciones">
          <button pButton type="button" class="btn-cancelar p-button-secondary" (click)="cerrarModal()" [label]="'Cancelar'"></button>
          <button pButton type="submit" class="btn-guardar" [label]="formulario.id ? 'Actualizar' : 'Guardar'" [icon]="'pi pi-save'"></button>
        </div>
      </form>
    </div>
  </div>
</div>